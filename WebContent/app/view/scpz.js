/*
 * File: app/view/scpz.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.scpz', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.scpz',

    requires: [
        'Ext.toolbar.Toolbar',
        'Ext.Img',
        'Ext.form.Label',
        'Ext.form.Panel',
        'Ext.form.field.File',
        'Ext.button.Button',
        'Ext.form.FieldContainer'
    ],

    border: false,
    width: 930,
    autoScroll: true,
    layout: 'absolute',
    title: '<font size=2.5px>上传资质</font>',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            dockedItems: [
                {
                    xtype: 'toolbar',
                    x: 273,
                    y: 9,
                    dock: 'top',
                    height: 50,
                    items: [
                        {
                            xtype: 'image',
                            height: 37,
                            width: 648,
                            src: 'images/lc2.png'
                        },
                        {
                            xtype: 'label',
                            height: 12,
                            style: {
                                fontSize: '12px',
                                cursor: 'pointer',
                                color: 'blue'
                            },
                            width: 84,
                            text: '我的购买指标',
                            listeners: {
                                click: {
                                    fn: me.onLabelClick1,
                                    element: 'el',
                                    scope: me
                                }
                            }
                        }
                    ]
                },
                {
                    xtype: 'container',
                    x: 20,
                    y: 670,
                    dock: 'bottom',
                    height: 180,
                    style: {
                        backgroundImage: 'url(images/footbg.png)'
                    },
                    width: 640,
                    layout: {
                        type: 'vbox',
                        align: 'center',
                        pack: 'center'
                    },
                    items: [
                        {
                            xtype: 'fieldcontainer',
                            height: 140,
                            style: {
                                backgroundColor: '#e0ffff',
                                borderRadius: '12px'
                            },
                            width: 719,
                            layout: 'absolute',
                            fieldLabel: '<font size=2.5>温馨提示</font>',
                            items: [
                                {
                                    xtype: 'label',
                                    x: -117,
                                    y: 5,
                                    text: '1）上传文件必须为图片格式，长90px，高120px'
                                },
                                {
                                    xtype: 'label',
                                    x: -116,
                                    y: 45,
                                    height: 20,
                                    text: '2)上传图片清晰，能够识别有效日期和单位公章'
                                },
                                {
                                    xtype: 'label',
                                    x: -117,
                                    y: 90,
                                    height: 20,
                                    text: '3）系统将于一个工作日内完成审核工作，请耐心等该'
                                }
                            ]
                        }
                    ]
                }
            ],
            items: [
                {
                    xtype: 'form',
                    x: 40,
                    y: 0,
                    border: false,
                    height: 280,
                    id: 'yyzz',
                    width: 350,
                    layout: 'absolute',
                    bodyPadding: 10,
                    title: '',
                    url: 'scyyzz',
                    items: [
                        {
                            xtype: 'filefield',
                            x: 50,
                            y: 20,
                            width: 200,
                            fieldLabel: '营业执照',
                            labelWidth: 60,
                            name: 'yyzz',
                            allowBlank: false,
                            blankText: '不能为空',
                            regex: /(.jpg)$/,
                            regexText: '格式必须为jpg',
                            buttonText: '浏览',
                            clearOnSubmit: false,
                            listeners: {
                                change: {
                                    fn: me.onFilefieldChange,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'image',
                            x: 60,
                            y: 60,
                            border: true,
                            height: 210,
                            id: 'success',
                            style: {
                                'border-style': 'solid',
                                'border-color': 'black'
                            },
                            width: 210
                        },
                        {
                            xtype: 'textfield',
                            x: 60,
                            y: 140,
                            hidden: true,
                            id: 'yyzzpcbh',
                            fieldLabel: 'Label',
                            name: 'zbpcbh'
                        }
                    ]
                },
                {
                    xtype: 'form',
                    x: 30,
                    y: 290,
                    border: false,
                    height: 280,
                    id: 'zzdm',
                    width: 350,
                    layout: 'absolute',
                    bodyPadding: 10,
                    title: '',
                    url: 'sczzdm',
                    items: [
                        {
                            xtype: 'filefield',
                            x: 50,
                            y: 20,
                            width: 200,
                            fieldLabel: '组织代码证',
                            labelWidth: 70,
                            name: 'zzdm',
                            allowBlank: false,
                            blankText: '不能为空',
                            regex: /(.jpg)$/,
                            regexText: '格式必须为jpg',
                            buttonText: '浏览',
                            clearOnSubmit: false,
                            listeners: {
                                change: {
                                    fn: me.onFilefieldChange1,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'image',
                            x: 60,
                            y: 60,
                            border: true,
                            height: 210,
                            style: {
                                'border-style': 'solid',
                                'border-color': 'black'
                            },
                            width: 210
                        },
                        {
                            xtype: 'textfield',
                            x: 70,
                            y: 160,
                            hidden: true,
                            id: 'zzdmpcbh',
                            fieldLabel: 'Label',
                            name: 'zbpcbh'
                        }
                    ]
                },
                {
                    xtype: 'form',
                    x: 480,
                    y: 290,
                    border: false,
                    height: 280,
                    id: 'sfzm',
                    width: 350,
                    layout: 'absolute',
                    bodyPadding: 10,
                    title: '',
                    url: 'scsfzm',
                    items: [
                        {
                            xtype: 'filefield',
                            x: 50,
                            y: 20,
                            width: 200,
                            fieldLabel: '身份凭证',
                            labelWidth: 60,
                            name: 'sfzm',
                            allowBlank: false,
                            blankText: '不能为空',
                            regex: /(.jpg)$/,
                            regexText: '格式必须为jpg',
                            buttonText: '浏览',
                            clearOnSubmit: false,
                            listeners: {
                                change: {
                                    fn: me.onFilefieldChange2,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'image',
                            x: 60,
                            y: 60,
                            border: true,
                            height: 210,
                            style: {
                                'border-style': 'solid',
                                'border-color': 'black'
                            },
                            width: 210
                        },
                        {
                            xtype: 'textfield',
                            x: 50,
                            y: 170,
                            hidden: true,
                            id: 'sfzmpcbh',
                            fieldLabel: 'Label',
                            name: 'zbpcbh'
                        }
                    ]
                },
                {
                    xtype: 'form',
                    x: 480,
                    y: 0,
                    border: false,
                    height: 280,
                    id: 'nspz',
                    width: 350,
                    layout: 'absolute',
                    bodyPadding: 10,
                    title: '',
                    url: 'scnspz',
                    items: [
                        {
                            xtype: 'filefield',
                            x: 50,
                            y: 20,
                            width: 200,
                            fieldLabel: '纳税凭证',
                            labelWidth: 60,
                            name: 'nspz',
                            allowBlank: false,
                            blankText: '不能为空',
                            regex: /(.jpg)$/,
                            regexText: '格式必须为jpg',
                            buttonText: '浏览',
                            clearOnSubmit: false,
                            listeners: {
                                change: {
                                    fn: me.onFilefieldChange3,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'image',
                            x: 60,
                            y: 60,
                            border: true,
                            height: 210,
                            style: {
                                'border-style': 'solid',
                                'border-color': 'black'
                            },
                            width: 210
                        },
                        {
                            xtype: 'textfield',
                            x: 36,
                            y: 139,
                            hidden: true,
                            id: 'nspzpcbh',
                            fieldLabel: 'Label',
                            name: 'zbpcbh'
                        }
                    ]
                },
                {
                    xtype: 'textfield',
                    x: 320,
                    y: 150,
                    hidden: true,
                    id: 'bh',
                    fieldLabel: 'Label'
                },
                {
                    xtype: 'button',
                    handler: function(button, event) {
                        var store=Ext.StoreMgr.get('zbgmstore');
                        var zbpcbh=Ext.getCmp('sfzmpcbh').getValue();
                        var record=store.findRecord('zbpcbh',zbpcbh);
                        //alert(record.get('sgsl'));
                        var p=Ext.widget('tjdd');
                        p.loadRecord(record);
                        //var title=record.get('zbpcbh');
                        //p.setTitle("<font size=2.5px>"+"指标批次编号"+title+"</font>");
                        p.getComponent('sgsl').setValue(Ext.Number.from(record.get('sgsl'),1));
                        var zed=Ext.Number.from(record.get('dwed'),1)*Ext.Number.from(record.get('sl'),1);
                        var sgze=Ext.Number.from(record.get('dwed'),1)*Ext.Number.from(record.get('sgsl'),1);
                        Ext.getCmp('zed').setValue(zed);
                        Ext.getCmp('sgze').setValue(zed);

                        var panel=Ext.getCmp('contentPanel');

                        panel.removeAll();
                        panel.add(p);
                    },
                    x: 280,
                    y: 590,
                    height: 25,
                    width: 100,
                    text: '<font size=2.5>上一步</font>',
                    tooltip: '返回提交订单页面'
                },
                {
                    xtype: 'button',
                    handler: function(button, event) {
                        var form1=Ext.getCmp('yyzz');
                        var form2=Ext.getCmp('nspz');
                        var form3=Ext.getCmp('zzdm');
                        var form4=Ext.getCmp('sfzm');
                        var zbpcbh=Ext.getCmp('bh').getValue();
                        if(form1.isValid()&&form2.isValid()&&form3.isValid()&&form4.isValid())
                        {

                            Ext.Ajax.request(
                            {
                                url:'pzscsh',
                                method:'get',
                                headers:{

                                    'Content-Type':'application/json'
                                },

                                success:function(response){


                                    var store=Ext.StoreMgr.get('zbgmstore');

                                    var n=store.find('zbpcbh',zbpcbh);
                                    //alert(n);
                                    store.getAt(n).set('pczt','待审核');

                                    Ext.MessageBox.alert('提示','已经提交资质凭证，正在等待管理员审核，审核完毕后请提交保证金',function(){
                                        var panel=Ext.getCmp('contentPanel');

                                        var zbsg=Ext.widget('wdsglb');
                                        panel.removeAll();
                                        panel.add(zbsg);

                                    });
                                },


                                failure:function(){
                                    //Ext.MessageBox.alert('错误','操作失败！');
                                },
                                params:{'bh':zbpcbh}

                            });
                        }
                        else
                        {
                            Ext.MessageBox.alert('提示','请先上传所有凭证');
                        }
                    },
                    x: 450,
                    y: 590,
                    height: 25,
                    style: {
                        background: '#ffa500',
                        border: 'none',
                        borderColor: 'white'
                    },
                    width: 100,
                    text: '<font size=2.5 color=\'white\'>提交</font>',
                    tooltip: '提交资质凭证'
                }
            ]
        });

        me.callParent(arguments);
    },

    onLabelClick1: function(label) {

        var panel=Ext.getCmp('contentPanel');

        var zbsg=Ext.widget('wdsglb');
        panel.removeAll();
        panel.add(zbsg);

    },

    onFilefieldChange: function(filefield, value, eOpts) {
        var form=Ext.getCmp('yyzz');

        if(form.isValid())
        form.getForm().submit(
        {

            // method:'post',
            waitMsg: '正在上传......',
            success:function(form, action){

                var photoUrl=action.result.msg;
                // alert(photoUrl);
                var photo=Ext.getCmp('yyzz').items.get(1);
                //alert(photo.getId());
                photo.getEl().dom.src=photoUrl;

            },
            failure:function(){
                Ext.MessageBox.alert('提示','操作失败！');
            }

        }
        );
    },

    onFilefieldChange1: function(filefield, value, eOpts) {
        var form=Ext.getCmp('zzdm');

        if(form.isValid())
        form.getForm().submit(
        {

            // method:'post',
            waitMsg: '正在上传......',
            success:function(form, action){

                var photoUrl=action.result.msg;
                //alert(photoUrl);
                var photo=Ext.getCmp('zzdm').items.get(1);
                //alert(photo.getId());
                photo.getEl().dom.src=photoUrl;

            },
            failure:function(){
                Ext.MessageBox.alert('提示','操作失败！');
            }

        }
        );
    },

    onFilefieldChange2: function(filefield, value, eOpts) {
        var form=Ext.getCmp('sfzm');

        if(form.isValid())
        form.getForm().submit(
        {

            // method:'post',
            waitMsg: '正在上传......',
            success:function(form, action){

                var photoUrl=action.result.msg;
                //alert(photoUrl);
                var photo=Ext.getCmp('sfzm').items.get(1);
                //alert(photo.getId());
                photo.getEl().dom.src=photoUrl;

            },
            failure:function(){
                Ext.MessageBox.alert('提示','操作失败！');
            }

        }
        );
    },

    onFilefieldChange3: function(filefield, value, eOpts) {
        var form=Ext.getCmp('nspz');

        if(form.isValid())
        form.getForm().submit(
        {

            // method:'post',
            waitMsg: '正在上传......',
            success:function(form, action){

                var photoUrl=action.result.msg;
                //alert(photoUrl);
                var photo=Ext.getCmp('nspz').items.get(1);
                //alert(photo.getId());
                photo.getEl().dom.src=photoUrl;

            },
            failure:function(){
                Ext.MessageBox.alert('提示','操作失败！');
            }

        }
        );
    }

});