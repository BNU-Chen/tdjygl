/*
 * File: app/view/infoArticleTab.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.infoArticleTab', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.infoArticleTab',

    requires: [
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.grid.RowNumberer',
        'Ext.grid.column.Date',
        'Ext.grid.View',
        'Ext.selection.CheckboxModel',
        'Ext.form.field.Date',
        'Ext.button.Button',
        'Ext.toolbar.Paging'
    ],

    id: 'infoArticleTab',
    title: '文章管理-列表',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    height: 421,
                    id: '',
                    autoScroll: true,
                    layout: 'fit',
                    bodyPadding: 10,
                    title: 'My Form',
                    jsonSubmit: true,
                    items: [
                        {
                            xtype: 'gridpanel',
                            height: 241,
                            id: 'articlegrid',
                            collapsible: false,
                            title: '文章列表',
                            store: 'InfoArticleStore',
                            columns: [
                                {
                                    xtype: 'rownumberer'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'articleId',
                                    text: '文章ID'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'articleName',
                                    text: '文章标题'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'channelId',
                                    text: '频道栏目'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'articleAuthor',
                                    text: '作者'
                                },
                                {
                                    xtype: 'datecolumn',
                                    dataIndex: 'articlePublishtime',
                                    text: '发布时间'
                                }
                            ],
                            selModel: Ext.create('Ext.selection.CheckboxModel', {

                            }),
                            dockedItems: [
                                {
                                    xtype: 'toolbar',
                                    dock: 'top',
                                    frame: false,
                                    enableOverflow: true,
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            width: 204,
                                            fieldLabel: '按频道栏目查询',
                                            selectOnFocus: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            width: 176,
                                            fieldLabel: '按作者查询'
                                        },
                                        {
                                            xtype: 'textfield',
                                            width: 211,
                                            fieldLabel: '按文章标题查询'
                                        },
                                        {
                                            xtype: 'datefield',
                                            width: 204,
                                            fieldLabel: '按时间查询'
                                        },
                                        {
                                            xtype: 'button',
                                            text: '查询文章'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'toolbar',
                                    dock: 'top',
                                    items: [
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var grid = Ext.getCmp('articlegrid');
                                                var record = grid.getSelectionModel().getSelection();
                                                var articleSelectedId = record[0].get("articleId");
                                                Ext.Msg.alert('提示', articleSelectedId);


                                                if (record.length === 0) {
                                                    Ext.Msg.alert('提示', '请先选择您要操作的行！');
                                                    return;

                                                } else if (record.length > 1) {
                                                    Ext.Msg.alert('提示', '只能选择一行数据');
                                                    return;
                                                } else {


                                                    var tabs = this.up('tabpanel');
                                                    tabs.removeAll(true);
                                                    //用tabs.add()新增加一个tab页面,通过Ext.widget(xtype)得到文章回收站的页面
                                                    var newtab = tabs.add(Ext.widget('infoArticlePublishTab'));


                                                    //先通过id获得文章发表的form表单，然后加载数据，传过去的参数为articleSelectedId，url为get_infoArticleDetail
                                                    var articleForm = newtab.getComponent('articleDetailForm');
                                                    Ext.Msg.alert('提示', articleForm.id);
                                                    articleForm.load({
                                                        params: {
                                                            articleSelectedId: articleSelectedId
                                                        },
                                                        url:'get_infoArticleDetail',
                                                        method:'GET',
                                                        success:function(form,action){
                                                            Ext.Msg.alert('提示','数据加载成功');
                                                        },
                                                        failure:function(form,action){
                                                            Ext.Msg.alert('提示','数据加载失败');
                                                        }
                                                    });



                                                }
                                            },
                                            text: '编辑文章'
                                        },
                                        {
                                            xtype: 'button',
                                            text: '查看文章'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var grid = Ext.getCmp('articlegrid');
                                                //var gird = this.down('grid');
                                                var record = grid.getSelectionModel().getSelection();

                                                if(record.length === 0){
                                                    Ext.Msg.alert('提示','请先选择您要操作的行！');
                                                    return;

                                                }else{


                                                    //var articleIds='';
                                                    //for(var i=0;i<record.length;i++)
                                                    //{
                                                    //    articleIds+=record[i].get("articleId");
                                                    //    if(i<record.length-1)articleIds=articleIds+",";
                                                    //}
                                                    //Ext.Msg.alert('提示',articleIds);



                                                    var  articleIds =new Array(record.length);
                                                    for(var i = 0;i<record.length;i++){
                                                        articleIds[i] = record[i].get("articleId");

                                                    }
                                                    //Ext.Msg.alert('提示',articleIds);



                                                    Ext.Ajax.request({
                                                        url:'update_articleIsrecycle',
                                                        params:{articleIds:articleIds},

                                                        success:function(response){
                                                            Ext.Msg.alert('success','文章放入到回收站');
                                                            var mystore2 = Ext.StoreMgr.get('InfoArticleStore');
                                                            mystore2.load(
                                                            {
                                                                params:{
                                                                    start:"0",
                                                                    limit:"10"

                                                                }
                                                            }
                                                            );

                                                        }

                                                    });

                                                }
                                            },
                                            text: '移入回收站'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function(button, event) {
                                                var tabs = this.up('tabpanel');
                                                tabs.removeAll(true);
                                                //用tabs.add()新增加一个tab页面,通过Ext.widget(xtype)得到文章回收站的页面
                                                var newtab = tabs.add(Ext.widget('infoArticleRecycleTab'));
                                                //tabs.setActiveTab(newtab);
                                                //Ext.Msg.alert('提示','Current tab: ' + tabs.id + " " + tabs.title +newtab.title);






                                                //var grid = Ext.getCmp('articlegrid');

                                                //var gird = this.down('grid');
                                                //var record = grid.getSelectionModel().getSelection();

                                                //if (record.length === 0) {
                                                //    Ext.Msg.alert('提示', '请先选择您要操作的行！');
                                                //    return;
                                                //
                                                //} else if (record.length > 1) {
                                                //    Ext.Msg.alert('提示', '只能选择一行数据');
                                                //    return;
                                                //} else {






                                                ////var tabs = Ext.getCmp('MyMainTabPanel');
                                                // var oldtab = tabs.getComponent('infoArticleTab');
                                                //var newtab = Ext.getCmp('infoArticleRecycleTab');
                                                //    tabs.setActiveTab(newtab);
                                                //Ext.Msg.alert('提示','Current tab: ' + tabs.id + " " + tabs.title +newtab.id);



                                                //var articleIds = new Array(record.length);
                                                //for (var i = 0; i < record.length; i++) {
                                                //    articleIds[i] = record[i].get("articleId");

                                                //}
                                                // Ext.Msg.alert('提示', articleIds);

                                                // Ext.Ajax.request({
                                                //   url: 'update_articleIsrecycle',
                                                //   params: {
                                                //       articleIds: articleIds
                                                //  },

                                                //  success: function(response) {
                                                //      Ext.Msg.alert('success', '文章放入到回收站');
                                                //     var mystore2 = Ext.StoreMgr.get('InfoArticleStore');
                                                //      mystore2.load({
                                                //          params: {
                                                //             start: "0",
                                                //             limit: "10"

                                                //        }
                                                //     });

                                                // }

                                                //});

                                                //}
                                            },
                                            text: '查看回收站'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'pagingtoolbar',
                                    dock: 'bottom',
                                    height: 36,
                                    width: 360,
                                    displayInfo: true,
                                    store: 'InfoArticleStore'
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    }

});