/*
 * File: app/view/infoAritcleNDZCNewWindow.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.infoAritcleNDZCNewWindow', {
    extend: 'Ext.window.Window',
    alias: 'widget.infoAritcleNDZCNewWindow',

    requires: [
        'Ext.form.Panel',
        'Ext.form.Label',
        'Ext.form.field.ComboBox',
        'Ext.form.field.HtmlEditor',
        'Ext.button.Button'
    ],

    height: 471,
    id: 'infoAritcleNDZCNewWindow',
    width: 604,
    autoScroll: true,
    layout: 'absolute',
    title: '发表新信息',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    height: 420,
                    id: 'infoArticleNDZCNewForm',
                    layout: 'absolute',
                    bodyPadding: 10,
                    title: '',
                    jsonSubmit: true,
                    items: [
                        {
                            xtype: 'label',
                            text: '名称：'
                        },
                        {
                            xtype: 'label',
                            x: 0,
                            y: 40,
                            height: 14,
                            text: '作者：'
                        },
                        {
                            xtype: 'label',
                            x: 0,
                            y: 80,
                            text: '信息来源：'
                        },
                        {
                            xtype: 'label',
                            x: 0,
                            y: 200,
                            text: '内容：'
                        },
                        {
                            xtype: 'label',
                            x: 310,
                            y: 40,
                            height: 10,
                            text: '频道栏目：'
                        },
                        {
                            xtype: 'label',
                            x: 0,
                            y: 160,
                            text: '地块坐标：'
                        },
                        {
                            xtype: 'label',
                            x: 0,
                            y: 120,
                            text: ''
                        },
                        {
                            xtype: 'combobox',
                            x: 80,
                            y: 120,
                            id: 'infoNDZCProvice',
                            width: 70,
                            fieldLabel: '',
                            submitValue: false,
                            displayField: 'areaName',
                            store: 'infoArticleStoreProvice',
                            valueField: 'areaCode',
                            listeners: {
                                select: {
                                    fn: me.onInfoNDZCProviceSelect,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'label',
                            x: 0,
                            y: 120,
                            text: '所在行政区：'
                        },
                        {
                            xtype: 'combobox',
                            x: 170,
                            y: 120,
                            id: 'infoNDZCCity',
                            width: 90,
                            fieldLabel: '',
                            submitValue: false,
                            displayField: 'areaName',
                            store: 'infoArticleStoreCity',
                            valueField: 'areaCode',
                            listeners: {
                                select: {
                                    fn: me.onInfoNDZCCitySelect,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'combobox',
                            x: 280,
                            y: 120,
                            id: 'infoNDZCCounty',
                            width: 100,
                            fieldLabel: '',
                            submitValue: false,
                            displayField: 'areaName',
                            store: 'infoArticleStoreCounty',
                            valueField: 'areaCode',
                            listeners: {
                                select: {
                                    fn: me.onInfoNDZCCountySelect,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            x: 80,
                            y: 0,
                            id: 'articleName',
                            width: 460,
                            fieldLabel: '',
                            name: 'articleName'
                        },
                        {
                            xtype: 'textfield',
                            x: 80,
                            y: 40,
                            id: 'articleAuthor',
                            width: 170,
                            fieldLabel: '',
                            name: 'articleAuthor'
                        },
                        {
                            xtype: 'textfield',
                            x: 80,
                            y: 80,
                            id: 'articleSource',
                            width: 460,
                            fieldLabel: '',
                            name: 'articleSource'
                        },
                        {
                            xtype: 'combobox',
                            x: 390,
                            y: 40,
                            id: 'channelId',
                            width: 150,
                            fieldLabel: '',
                            name: 'channelId',
                            value: 3,
                            displayField: 'channelName',
                            store: 'InfoChannelStore',
                            valueField: 'channelId'
                        },
                        {
                            xtype: 'label',
                            x: 150,
                            y: 120,
                            height: 10,
                            text: '----'
                        },
                        {
                            xtype: 'label',
                            x: 260,
                            y: 120,
                            text: '----'
                        },
                        {
                            xtype: 'label',
                            x: 380,
                            y: 120,
                            text: '----'
                        },
                        {
                            xtype: 'textfield',
                            x: 80,
                            y: 160,
                            id: 'coordinate',
                            width: 460,
                            fieldLabel: '',
                            name: 'coordinate'
                        },
                        {
                            xtype: 'label',
                            x: 320,
                            y: 180,
                            height: 10,
                            text: '例：纬度，经度；纬度，经度'
                        },
                        {
                            xtype: 'htmleditor',
                            anchor: '100%',
                            x: 80,
                            y: 210,
                            height: 150,
                            id: 'articleContent',
                            fieldLabel: '',
                            name: 'articleContent'
                        },
                        {
                            xtype: 'button',
                            x: 120,
                            y: 380,
                            text: '发表信息',
                            listeners: {
                                click: {
                                    fn: me.onButtonClick,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'button',
                            x: 250,
                            y: 380,
                            text: '存入草稿箱',
                            listeners: {
                                click: {
                                    fn: me.onButtonClick1,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'button',
                            x: 410,
                            y: 380,
                            text: '取    消',
                            listeners: {
                                click: {
                                    fn: me.onButtonClick2,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            x: 10,
                            y: 250,
                            hidden: true,
                            id: 'articlePublishtime',
                            width: 50,
                            fieldLabel: '',
                            name: 'articlePublishtime'
                        },
                        {
                            xtype: 'textfield',
                            x: 10,
                            y: 290,
                            hidden: true,
                            id: 'areaCode',
                            width: 50,
                            fieldLabel: '',
                            name: 'areaCode'
                        },
                        {
                            xtype: 'combobox',
                            x: 400,
                            y: 120,
                            id: 'infoNDZCVillage',
                            width: 110,
                            fieldLabel: '',
                            submitValue: false,
                            displayField: 'areaName',
                            store: 'infoArticleStoreVillage',
                            valueField: 'areaCode'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onInfoNDZCProviceSelect: function(combo, records, eOpts) {

        var codeHead=records[0].get('areaCode');

        Ext.Ajax.request({
            url:'get_infoArticleCity',
            params:{codeHead:codeHead},
            success:function(response){
                var mystore = Ext.StoreMgr.get('infoArticleStoreCity');
                mystore.load(
                {
                    params:{
                        codeHead: codeHead
                    }
                }
                );
            }
        });
        var  cityStore=Ext.StoreMgr.get('infoArticleStoreCity');//获取store对象

        var cityField=Ext.getCmp("infoNDZCCity");
        cityField.setValue('');

        var countyField=Ext.getCmp("infoNDZCCounty");
        countyField.setValue('');

        var villageField=Ext.getCmp("infoNDZCVillage");
        villageField.setValue('');

        if(cityField.view)
        cityField.view.setStore(cityStore);
    },

    onInfoNDZCCitySelect: function(combo, records, eOpts) {

        var codeHead=records[0].get('areaCode');

        Ext.Ajax.request({
            url:'get_infoArticleCounty',
            params:{codeHead:codeHead},
            success:function(response){
                var mystore = Ext.StoreMgr.get('infoArticleStoreCounty');
                mystore.load(
                {
                    params:{
                        codeHead: codeHead
                    }
                }
                );
            }
        });
        var  countyStore=Ext.StoreMgr.get('infoArticleStoreCounty');//获取store对象


        var countyField=Ext.getCmp("infoNDZCCounty");
        countyField.setValue('');

        var villageField=Ext.getCmp("infoNDZCVillage");
        villageField.setValue('');


        if(countyField.view)
        countyField.view.setStore(countyStore);
    },

    onInfoNDZCCountySelect: function(combo, records, eOpts) {

        var codeHead=records[0].get('areaCode');

        Ext.Ajax.request({
            url:'get_infoArticleVillage',
            params:{codeHead:codeHead},
            success:function(response){
                var mystore = Ext.StoreMgr.get('infoArticleStoreVillage');
                mystore.load(
                {
                    params:{
                        codeHead: codeHead
                    }
                }
                );
            }
        });
        var  villageStore=Ext.StoreMgr.get('infoArticleStoreVillage');//获取store对象


        var villageField=Ext.getCmp("infoNDZCVillage");
        villageField.setValue('');


        if(villageField.view)
        villageField.view.setStore(villageStore);
    },

    onButtonClick: function(button, e, eOpts) {

        var proviceField=Ext.getCmp("infoNDZCProvice");
        var proviceValue=proviceField.getValue();
        proviceField.setDisabled(true);

        var cityField=Ext.getCmp("infoNDZCCity");
        var cityValue=cityField.getValue();
        cityField.setDisabled(true);

        var  countyField=Ext.getCmp("infoNDZCCounty");
        var  countyValue=countyField.getValue();
        countyField.setDisabled(true);

        var villageField=Ext.getCmp("infoNDZCVillage");
        var  villageValue=villageField.getValue();
        villageField.setDisabled(true);

        var areaCodeField=Ext.getCmp("areaCode");

        if(villageValue !==''){areaCodeField.setValue(villageValue);}
        else
        {
            if(countyValue!==''){areaCodeField.setValue(countyValue);}
            else{
                if(cityValue!==''){areaCodeField.setValue(cityValue);}
                else{
                    if(proviceValue!==''){areaCodeField.setValue(proviceValue);}
                }
            }
        }


        var myform1 = Ext.getCmp('infoArticleNDZCNewForm').getForm();
        if (myform1.isValid()) { // make sure the form contains valid data before submitting
            myform1.submit({
                url:'add_pubArticle',

                success: function(form, action) {
                    Ext.Msg.alert('success', '修改内容成功');

                    var mystore = Ext.StoreMgr.get('ArticlePubNDZCStore'); //获得store对象
                    mystore.load();
                    Ext.getCmp('infoAritcleNDZCNewWindow').close();

                },
                failure: function(form, action) {
                    Ext.getCmp('infoAritcleNDZCNewWindow').close();
                    Ext.Msg.alert('failure', '修改内容失败');

                }
            });
        } else {
            Ext.Msg.alert('注意', '填写信息不能为空，请检查！');
        }

        return;
    },

    onButtonClick1: function(button, e, eOpts) {

        var proviceField=Ext.getCmp("infoNDZCProvice");
        var proviceValue=proviceField.getValue();
        proviceField.setDisabled(true);

        var cityField=Ext.getCmp("infoNDZCCity");
        var cityValue=cityField.getValue();
        cityField.setDisabled(true);

        var  countyField=Ext.getCmp("infoNDZCCounty");
        var  countyValue=countyField.getValue();
        countyField.setDisabled(true);

        var villageField=Ext.getCmp("infoNDZCVillage");
        var  villageValue=villageField.getValue();
        villageField.setDisabled(true);

        var areaCodeField=Ext.getCmp("areaCode");

        if(villageValue !==''){areaCodeField.setValue(villageValue);}
        else
        {
            if(countyValue!==''){areaCodeField.setValue(countyValue);}
            else{
                if(cityValue!==''){areaCodeField.setValue(cityValue);}
                else{
                    if(proviceValue!==''){areaCodeField.setValue(proviceValue);}
                }
            }
        }


        var myform = Ext.getCmp('infoArticleNDZCNewForm').getForm();
        if (myform.isValid()) { // make sure the form contains valid data before submitting
            myform.submit({
                url:'add_draftArticle',

                success: function(form, action) {
                    Ext.Msg.alert('success', '存储成功');

                    var mystore = Ext.StoreMgr.get('ArticlePubNDZCStore'); //获得store对象
                    mystore.load();
                    Ext.getCmp('infoAritcleNDZCNewWindow').close();

                },
                failure: function(form, action) {
                    Ext.getCmp('infoAritcleNDZCNewWindow').close();
                    Ext.Msg.alert('failure', '存储失败');

                }
            });
        } else {
            Ext.Msg.alert('注意', '填写信息不能为空，请检查！');
        }

        return;

    },

    onButtonClick2: function(button, e, eOpts) {
        Ext.getCmp('infoAritcleNDZCNewWindow').close();
    }

});