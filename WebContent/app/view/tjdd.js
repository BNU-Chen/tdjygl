/*
 * File: app/view/tjdd.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.tjdd', {
    extend: 'Ext.form.Panel',
    alias: 'widget.tjdd',

    requires: [
        'Ext.button.Button',
        'Ext.form.FieldSet',
        'Ext.form.field.Display',
        'Ext.toolbar.Toolbar',
        'Ext.Img',
        'Ext.form.FieldContainer',
        'Ext.form.Label',
        'Ext.form.field.Number'
    ],

    height: 660,
    id: 'tjdd',
    width: 940,
    layout: 'absolute',
    bodyPadding: 10,
    title: '<font size=2.5px>订单提交</font>',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            bodyCls: [
                'mylabel',
                'x-panel-body-default',
                'x-abs-layout-ct'
            ],
            bodyStyle: {
                backgroundImage: 'url(images/bg.png)'
            },
            items: [
                {
                    xtype: 'button',
                    handler: function(button, event) {
                        var panel=Ext.getCmp('contentPanel');
                        var p=Ext.widget('zbsq');
                        panel.removeAll();
                        panel.add(p);
                    },
                    x: 318,
                    y: 330,
                    height: 25,
                    width: 100,
                    text: '<font size=2.5px>上一步</font>',
                    tooltip: '返回指标申购列表页面'
                },
                {
                    xtype: 'button',
                    handler: function(button, event) {
                        var form=Ext.getCmp('tjdd');
                        var store=Ext.StoreMgr.get('zbgmstore');
                        var zbpcbh=form.items.get(2).getComponent('zbpcbh').getValue();
                        if(form.isValid())
                        {
                            var sgsl=form.items.get(4).getValue();
                            // alert(sgsl);
                            store.add(form.getValues());
                            // alert(store.count());
                            var record=store.findRecord('zbpcbh',zbpcbh);
                            //var record=form.getValues();
                            record.set('sgsl',sgsl);
                            record.set('pczt','尚未提交');
                            record.commit();
                            Ext.Ajax.request(
                            {
                                url:'tjdd',
                                method:'post',
                                headers:{

                                    'Content-Type':'application/json'
                                },
                                params:Ext.encode(record.getData()),
                                success:function(response){
                                    // Ext.StoreMgr.get('zbgmstore').add(Ext.getCmp('tjdd').getValues());
                                    var panel=Ext.getCmp('contentPanel');
                                    var p=Ext.widget('scpz');
                                    Ext.getCmp('yyzzpcbh').setValue(record.get('zbpcbh'));
                                    Ext.getCmp('nspzpcbh').setValue(record.get('zbpcbh'));
                                    Ext.getCmp('zzdmpcbh').setValue(record.get('zbpcbh'));
                                    Ext.getCmp('sfzmpcbh').setValue(record.get('zbpcbh'));
                                    Ext.getCmp('bh').setValue(record.get('zbpcbh'));
                                    panel.removeAll();
                                    panel.add(p);
                                },

                                failure:function(){
                                    //Ext.MessageBox.alert('错误','操作失败！');
                                }

                            });

                        }
                    },
                    x: 495,
                    y: 328,
                    cls: 'aa',
                    height: 25,
                    style: {
                        background: '#ffa500',
                        border: 'none',
                        borderColor: 'white'
                    },
                    width: 100,
                    text: '<font size=2.5px>提交订单</font>',
                    tooltip: '进入资质审核环节'
                },
                {
                    xtype: 'fieldset',
                    x: 59,
                    y: 39,
                    height: 160,
                    style: {
                        borderRadius: '10px'
                    },
                    width: 820,
                    layout: 'absolute',
                    title: '<font size=2.5px color=white>指标信息</font>',
                    items: [
                        {
                            xtype: 'displayfield',
                            x: 30,
                            y: 20,
                            itemId: 'zbpcbh',
                            fieldLabel: '指标批次编号',
                            name: 'zbpcbh',
                            submitValue: true
                        },
                        {
                            xtype: 'displayfield',
                            renderer: function(value, displayField) {
                                return value+'公顷';
                            },
                            x: 590,
                            y: 80,
                            id: 'zed',
                            fieldLabel: '总额度',
                            name: 'zed'
                        },
                        {
                            xtype: 'displayfield',
                            renderer: function(value, displayField) {
                                if(value==1)
                                return "申请阶段";
                                if(value==2)
                                return "交保证金阶段";
                                if(value==3)
                                return "竞价阶段";
                                if(value==4)
                                return "网签阶段";
                                if(value==5)
                                return "网备阶段";
                            },
                            x: 310,
                            y: 20,
                            itemId: 'dqhj',
                            fieldLabel: '当前环节',
                            name: 'dqhj',
                            submitValue: true
                        },
                        {
                            xtype: 'displayfield',
                            x: 590,
                            y: 20,
                            fieldLabel: '截止日期',
                            name: 'sqjzrq',
                            submitValue: true
                        },
                        {
                            xtype: 'displayfield',
                            renderer: function(value, displayField) {
                                return value+'公顷/张';
                            },
                            x: 30,
                            y: 80,
                            itemId: 'dwed',
                            fieldLabel: '单位额度',
                            name: 'dwed',
                            submitValue: true
                        },
                        {
                            xtype: 'displayfield',
                            renderer: function(value, displayField) {
                                return value+'张';
                            },
                            x: 310,
                            y: 80,
                            id: 'zsl',
                            fieldLabel: '总数量',
                            name: 'sl',
                            submitValue: true
                        }
                    ]
                },
                {
                    xtype: 'fieldcontainer',
                    x: 51,
                    y: 425,
                    height: 130,
                    style: {
                        backgroundColor: '#e0ffff',
                        borderRadius: '12px'
                    },
                    width: 824,
                    layout: 'absolute',
                    fieldLabel: '',
                    items: [
                        {
                            xtype: 'label',
                            x: 0,
                            y: 10,
                            height: 10,
                            text: '1、订单审核前可以更改申购数量重新提交，审核通过后不能进行更改；'
                        },
                        {
                            xtype: 'label',
                            x: 0,
                            y: 50,
                            height: 15,
                            text: '2、如果订单审核未通过，在申购截止日期前可再次重新提交；'
                        },
                        {
                            xtype: 'label',
                            x: -1,
                            y: 85,
                            height: 10,
                            text: '3、超过申购截止日期仍未提交订单视为自动放弃'
                        },
                        {
                            xtype: 'label',
                            x: -80,
                            y: 10,
                            text: '温馨提示：'
                        }
                    ]
                },
                {
                    xtype: 'numberfield',
                    validator: function(value) {
                        var sl=Ext.getCmp('zsl').getValue();
                        if(Ext.Number.from(value,1)>sl)
                        {
                            return '申请数量不能大于该批次总数';
                        }
                        else
                        return true;
                    },
                    x: 105,
                    y: 239,
                    itemId: 'sgsl',
                    width: 180,
                    fieldLabel: '申购数量',
                    labelWidth: 60,
                    msgTarget: 'under',
                    name: 'sgsl',
                    value: 1,
                    invalidText: '不能大于该批次总数',
                    regex: /^[0-9]*[1-9][0-9]*$/,
                    regexText: '必须大于等于1',
                    listeners: {
                        change: {
                            fn: me.onSgslChange,
                            scope: me
                        }
                    }
                },
                {
                    xtype: 'displayfield',
                    renderer: function(value, displayField) {
                        return value+'公顷';
                    },
                    x: 384,
                    y: 240,
                    id: 'sgze',
                    itemId: '',
                    fieldLabel: '申购总额'
                },
                {
                    xtype: 'label',
                    x: 260,
                    y: 243,
                    html: '<font size=2.5px color=white>张</font>'
                }
            ],
            dockedItems: [
                {
                    xtype: 'toolbar',
                    x: 176,
                    y: 10,
                    dock: 'top',
                    height: 40,
                    items: [
                        {
                            xtype: 'image',
                            height: 35,
                            width: 642,
                            src: 'images/lc1.png'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onSgslChange: function(field, newValue, oldValue, eOpts) {
        var sgze=Ext.getCmp('sgze');
        var dwed=this.items.get(2).getComponent('dwed').getValue();
        //alert(this.items.get(2).getId());
        sgze.setValue(dwed*Ext.Number.from(newValue,1));
    }

});